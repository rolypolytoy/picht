

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Picht &mdash; picht 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            picht
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Picht</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#electrode-creation">Electrode Creation</a></li>
<li><a class="reference internal" href="#unipotential-lenses">Unipotential Lenses</a></li>
<li><a class="reference internal" href="#advanced-use-case-sem-simulation">Advanced Use Case: SEM Simulation</a></li>
<li><a class="reference internal" href="#ion-support">Ion Support</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">picht</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Picht</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="picht">
<h1>Picht<a class="headerlink" href="#picht" title="Link to this heading"></a></h1>
<p>An electron optics library that uses the finite difference method (FDM) to simulate electron and ion trajectories through electrostatic lenses. Currently supports Dirichlet boundary conditions, relativistic energies, non-paraxial beam configurations, and provides pre-packaged support for cylindrical and unipotential (einzel) lenses, as well as scripting for custom lens geometries.</p>
<p>It exists to provide a tool that’s free and open-source, easily modifiable, and just as powerful as commercial tools, but with architectural decisions that enable even greater power and accuracy, through intelligent architectural decisions and a focus constrained to electron optics — a branch of computational physics with a relatively small open-source community. Capable of simulating electrostatic lens arrays, electron microscopes (SEM, TEM, STEM), focused ion beams (Ga/He/Ne), and mass spectrometers, and any and all applications, from the classical to relativistic regime that benefit from axisymmetric electron optics simulations without magnetic field handling.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>To install Picht via pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>picht
</pre></div>
</div>
<a class="reference external image-reference" href="https://pypi.org/project/picht/"><img alt="https://img.shields.io/pypi/v/picht.svg" src="https://img.shields.io/pypi/v/picht.svg" />
</a>
<a class="reference external image-reference" href="https://github.com/rolypolytoy/picht/actions/workflows/tests.yml"><img alt="https://github.com/rolypolytoy/picht/actions/workflows/tests.yml/badge.svg" src="https://github.com/rolypolytoy/picht/actions/workflows/tests.yml/badge.svg" />
</a>
<a class="reference external image-reference" href="https://opensource.org/licenses/MIT"><img alt="https://img.shields.io/badge/License-MIT-yellow.svg" src="https://img.shields.io/badge/License-MIT-yellow.svg" />
</a>
</section>
<section id="electrode-creation">
<h2>Electrode Creation<a class="headerlink" href="#electrode-creation" title="Link to this heading"></a></h2>
<p>Before creating any electrodes, we need to familiarize ourselves with a few concepts. First- whenever you initialize a system, you need to pick
nr, nz, axial_size and radial_size. nr is the grid resolution in the r-dimension, and nz is the same for the z-dimension. Axial_size is the total
length of the domain in meters in the z-dimension, and radial_size is the same for the r-dimension.</p>
<p>This means the grid resolution in the z-dimension is axial_size/nz, and in the r-dimension is radial_size/nr. You should, if using nonstandard values for these,
ensure you’re aware of these so you can properly convert from grid units to meters.</p>
<p>You can initialize a cylindrical electrode as as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">picht</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonOpticsSystem</span><span class="p">,</span> <span class="n">ElectrodeConfig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">IonOpticsSystem</span><span class="p">(</span><span class="n">nr</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">axial_size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">radial_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">electrode</span> <span class="o">=</span> <span class="n">ElectrodeConfig</span><span class="p">(</span>
     <span class="n">start</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
     <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
     <span class="n">ap_start</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
     <span class="n">ap_width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
     <span class="n">outer_diameter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
     <span class="n">voltage</span><span class="o">=-</span><span class="mi">5000</span>
     <span class="p">)</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">solve_fields</span><span class="p">()</span>

<span class="n">trajectories</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">simulate_beam</span><span class="p">(</span>
    <span class="n">energy_eV</span><span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">start_z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0499925</span><span class="p">,</span> <span class="mf">0.0500075</span><span class="p">),</span>
    <span class="n">angle_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">simulation_time</span><span class="o">=</span><span class="mf">2e-9</span>
<span class="p">)</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">visualize_system</span><span class="p">(</span>
    <span class="n">trajectories</span><span class="o">=</span><span class="n">trajectories</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="https://github.com/user-attachments/assets/493d152d-b57e-425d-bcfd-545ca7eefac4" src="https://github.com/user-attachments/assets/493d152d-b57e-425d-bcfd-545ca7eefac4" />
<p>Note the syntax for configuring an electrode, and how we parameterize the beam’s energy in eV, its start_z, and its radial range. Keep angle_range = (0, 0) for parallel beams, or (-θ, θ), where θ is your intended half-angle of divergence.
As we can see- this produces some degree of focusing behavior, but after the electrode ends, the beam divergences once more, showcasing why we don’t often use cylindrical-only lens elements, despite their simplicity.</p>
<p>Now, we’ll build an Einzel Lens at -5000V with a beam energy of 10keV electrons.</p>
</section>
<section id="unipotential-lenses">
<h2>Unipotential Lenses<a class="headerlink" href="#unipotential-lenses" title="Link to this heading"></a></h2>
<p>Einzel lenses are three cylindrical lenses arranged in a specific pattern: the first electrode is grounded (0V), the second is at its focus_voltage, and the third is also grounded at (0V).
They’re called unipotential lenses because they can provide beam focusing and defocusing without affecting the beam’s net energy, which reduces (sometimes!) the behavior we saw in cylindrical electrodes.
Always make sure the aperture_center (in grid units) aligns with the center of the r_range() when you parameterize your beam.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">picht</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonOpticsSystem</span><span class="p">,</span> <span class="n">ElectrodeConfig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">IonOpticsSystem</span><span class="p">(</span><span class="n">nr</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">axial_size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">radial_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">add_einzel_lens</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">aperture_center</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">aperture_width</span><span class="o">=</span><span class="mf">48.0</span><span class="p">,</span>
    <span class="n">outer_diameter</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">focus_voltage</span><span class="o">=-</span><span class="mi">5000</span>
<span class="p">)</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">solve_fields</span><span class="p">()</span>

<span class="n">trajectories</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">simulate_beam</span><span class="p">(</span>
    <span class="n">energy_eV</span><span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">start_z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0499925</span><span class="p">,</span> <span class="mf">0.0500075</span><span class="p">),</span>
    <span class="n">angle_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">simulation_time</span><span class="o">=</span><span class="mf">2e-9</span>
<span class="p">)</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">visualize_system</span><span class="p">(</span>
    <span class="n">trajectories</span><span class="o">=</span><span class="n">trajectories</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="https://github.com/user-attachments/assets/c14983e2-4fa1-4191-93e1-01c6a47082c2" src="https://github.com/user-attachments/assets/c14983e2-4fa1-4191-93e1-01c6a47082c2" />
<p>Here, we can see valid focusing behavior, which happens when the focus voltage is negative, and the particle is negatively charged, or vice versa.
We can thus make an einzel lens that causes divergent behavior by re-using the same code but flipping the sign on focus_voltage from -5000 to 5000:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">picht</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonOpticsSystem</span><span class="p">,</span> <span class="n">ElectrodeConfig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">IonOpticsSystem</span><span class="p">(</span><span class="n">nr</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">axial_size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">radial_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">add_einzel_lens</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">aperture_center</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">aperture_width</span><span class="o">=</span><span class="mf">48.0</span><span class="p">,</span>
    <span class="n">outer_diameter</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">focus_voltage</span><span class="o">=</span><span class="mi">5000</span>
<span class="p">)</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">solve_fields</span><span class="p">()</span>

<span class="n">trajectories</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">simulate_beam</span><span class="p">(</span>
    <span class="n">energy_eV</span><span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">start_z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0499925</span><span class="p">,</span> <span class="mf">0.0500075</span><span class="p">),</span>
    <span class="n">angle_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">simulation_time</span><span class="o">=</span><span class="mf">2e-9</span>
<span class="p">)</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">visualize_system</span><span class="p">(</span>
    <span class="n">trajectories</span><span class="o">=</span><span class="n">trajectories</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="https://github.com/user-attachments/assets/2f5890ed-85ba-47f0-988e-8695df49adb8" src="https://github.com/user-attachments/assets/2f5890ed-85ba-47f0-988e-8695df49adb8" />
<p>We can see clearly visible defocusing, demonstrating how einzel lenses are cleanly usable for both focusing and defocusing with single-character changes in the code.
Some problems that may occur when you set your focus voltage drastically above your energy in eV can be demonstrated by this example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">picht</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonOpticsSystem</span><span class="p">,</span> <span class="n">ElectrodeConfig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">IonOpticsSystem</span><span class="p">(</span><span class="n">nr</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">axial_size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">radial_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">add_einzel_lens</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">aperture_center</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">aperture_width</span><span class="o">=</span><span class="mf">48.0</span><span class="p">,</span>
    <span class="n">outer_diameter</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">focus_voltage</span><span class="o">=-</span><span class="mi">5000</span>
<span class="p">)</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">solve_fields</span><span class="p">()</span>

<span class="n">trajectories</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">simulate_beam</span><span class="p">(</span>
    <span class="n">energy_eV</span><span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">start_z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0499925</span><span class="p">,</span> <span class="mf">0.0500075</span><span class="p">),</span>
    <span class="n">angle_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">simulation_time</span><span class="o">=</span><span class="mf">2e-9</span>
<span class="p">)</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">visualize_system</span><span class="p">(</span>
    <span class="n">trajectories</span><span class="o">=</span><span class="n">trajectories</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Here the beam energy is only 100 eV but we revert to a -5kV focus voltage. Here, we see beam reflection, due to the extremely strong fields coming from the unipotential lens.
Whenever chaining several einzel lenses, this problem becomes especially pertinent, so carefully tuning electron energies and einzel lens focus voltages are important. Minimize the difference
between aperture_width and outer_diameter as well, for cleaner field configurations.</p>
<img alt="https://github.com/user-attachments/assets/7d54258c-4a83-4e33-b315-efc9c0d04d37" src="https://github.com/user-attachments/assets/7d54258c-4a83-4e33-b315-efc9c0d04d37" />
</section>
<section id="advanced-use-case-sem-simulation">
<h2>Advanced Use Case: SEM Simulation<a class="headerlink" href="#advanced-use-case-sem-simulation" title="Link to this heading"></a></h2>
<p>Here’s a full simulation of an electrostatic lens-only scanning electron microscope (SEM):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">picht</span><span class="w"> </span><span class="kn">import</span> <span class="n">IonOpticsSystem</span><span class="p">,</span> <span class="n">ElectrodeConfig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">IonOpticsSystem</span><span class="p">(</span><span class="n">nr</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">axial_size</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">radial_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">wehnelt1</span> <span class="o">=</span> <span class="n">ElectrodeConfig</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">ap_start</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">ap_width</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">outer_diameter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">voltage</span><span class="o">=-</span><span class="mi">5100</span>
<span class="p">)</span>
<span class="n">wehnelt2</span> <span class="o">=</span> <span class="n">ElectrodeConfig</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ap_start</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">ap_width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">outer_diameter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">voltage</span><span class="o">=-</span><span class="mi">5100</span>
<span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">add_electrode</span><span class="p">(</span><span class="n">wehnelt1</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">add_electrode</span><span class="p">(</span><span class="n">wehnelt2</span><span class="p">)</span>
<span class="n">anode</span> <span class="o">=</span> <span class="n">ElectrodeConfig</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">ap_start</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
    <span class="n">ap_width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">outer_diameter</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">voltage</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">cathode</span> <span class="o">=</span> <span class="n">ElectrodeConfig</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">ap_start</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">ap_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">outer_diameter</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">voltage</span><span class="o">=-</span><span class="mi">5000</span>
<span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">add_electrode</span><span class="p">(</span><span class="n">anode</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">add_einzel_lens</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">aperture_center</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">aperture_width</span><span class="o">=</span><span class="mf">48.0</span><span class="p">,</span>
    <span class="n">outer_diameter</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">focus_voltage</span><span class="o">=-</span><span class="mi">7000</span>
<span class="p">)</span>

<span class="n">system</span><span class="o">.</span><span class="n">add_einzel_lens</span><span class="p">(</span>
    <span class="n">position</span><span class="o">=</span><span class="mf">160.0</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
    <span class="n">aperture_center</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">aperture_width</span><span class="o">=</span><span class="mf">48.0</span><span class="p">,</span>
    <span class="n">outer_diameter</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">focus_voltage</span><span class="o">=-</span><span class="mi">6500</span>
<span class="p">)</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">solve_fields</span><span class="p">()</span>

<span class="n">trajectories</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">simulate_beam</span><span class="p">(</span>
    <span class="n">energy_eV</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">start_z</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
    <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0499925</span><span class="p">,</span> <span class="mf">0.0500075</span><span class="p">),</span>
    <span class="n">angle_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">simulation_time</span><span class="o">=</span><span class="mf">1e-8</span>
<span class="p">)</span>

<span class="n">figure</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">visualize_system</span><span class="p">(</span>
    <span class="n">trajectories</span><span class="o">=</span><span class="n">trajectories</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="https://github.com/user-attachments/assets/8e4bc3db-832a-4892-869d-d16839526ebe" src="https://github.com/user-attachments/assets/8e4bc3db-832a-4892-869d-d16839526ebe" />
<p>This synthesizes electrodes, einzel lens chaining, massively larger particle amoutns and advanced beam parameterization to provide a fully functional description of a production-level SEM system.
You can also zoom in radially by system.visualize_system() to be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">visualize_system</span><span class="p">(</span>
    <span class="n">trajectories</span><span class="o">=</span><span class="n">trajectories</span><span class="p">,</span>
    <span class="n">r_limits</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.049</span><span class="p">,</span> <span class="mf">0.051</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And you get the following as a result (num_particles to 6 electrons rather than the previous 100 for speed reasons)
.. image:: <a class="reference external" href="https://github.com/user-attachments/assets/5d8518e4-04b8-4677-aba3-23a68ba41b8d">https://github.com/user-attachments/assets/5d8518e4-04b8-4677-aba3-23a68ba41b8d</a></p>
</section>
<section id="ion-support">
<h2>Ion Support<a class="headerlink" href="#ion-support" title="Link to this heading"></a></h2>
<p>You can simulate ions by specifying them before computing trajectories:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">tracer</span><span class="o">.</span><span class="n">set_ion</span><span class="p">(</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="n">charge_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">tracer</span><span class="o">.</span><span class="n">set_ion</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">charge_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">tracer</span><span class="o">.</span><span class="n">set_ion</span><span class="p">(</span><span class="s1">&#39;Ga&#39;</span><span class="p">,</span> <span class="n">charge_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Supports helium, neon, hydrogen, sodium, gallium, and more via integration with the Mendeleev library. You can specify any combination of atoms and charges to produce all physically realistic, and even physically unrealistic ions.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Rishiit Sharma.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>